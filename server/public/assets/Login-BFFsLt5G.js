import{d as I,t as O,Y as D,c as R,$ as N,a1 as $,a as m,ay as M,ac as j,w as U,O as z,m as G,az as L,aA as Y,aB as q,_ as J,r as V,a0 as K,V as W,s as Z,v as b,x as w,z as H,A as _,F as Q,B as X,C as ee,y as F,D as E,E as v}from"./index-D0UB2ddu.js";import{D as se}from"./index-BJ8oVMt3.js";import"./use-placeholder-Bc7RdSAY.js";const[ae,te]=R("form"),oe={colon:Boolean,disabled:Boolean,readonly:Boolean,required:[Boolean,String],showError:Boolean,labelWidth:D,labelAlign:String,inputAlign:String,scrollToError:Boolean,scrollToErrorPosition:String,validateFirst:Boolean,submitOnEnter:O,showErrorMessage:O,errorMessageAlign:String,validateTrigger:{type:[String,Array],default:"onBlur"}};var re=I({name:ae,props:oe,emits:["submit","failed"],setup(t,{emit:l,slots:n}){const{children:f,linkChildren:p}=N(M),c=e=>e?f.filter(s=>e.includes(s.name)):f,g=e=>new Promise((s,o)=>{const i=[];c(e).reduce((C,r)=>C.then(()=>{if(!i.length)return r.validate().then(A=>{A&&i.push(A)})}),Promise.resolve()).then(()=>{i.length?o(i):s()})}),y=e=>new Promise((s,o)=>{const i=c(e);Promise.all(i.map(d=>d.validate())).then(d=>{d=d.filter(Boolean),d.length?o(d):s()})}),a=e=>{const s=f.find(o=>o.name===e);return s?new Promise((o,i)=>{s.validate().then(d=>{d?i(d):o()})}):Promise.reject()},h=e=>typeof e=="string"?a(e):t.validateFirst?g(e):y(e),T=e=>{typeof e=="string"&&(e=[e]),c(e).forEach(o=>{o.resetValidation()})},P=()=>f.reduce((e,s)=>(e[s.name]=s.getValidationStatus(),e),{}),B=(e,s)=>{f.some(o=>o.name===e?(o.$el.scrollIntoView(s),!0):!1)},S=()=>f.reduce((e,s)=>(s.name!==void 0&&(e[s.name]=s.formValue.value),e),{}),k=()=>{const e=S();h().then(()=>l("submit",e)).catch(s=>{l("failed",{values:e,errors:s});const{scrollToError:o,scrollToErrorPosition:i}=t;o&&s[0].name&&B(s[0].name,i?{block:i}:void 0)})},u=e=>{j(e),k()};return p({props:t}),$({submit:k,validate:h,getValues:S,scrollToField:B,resetValidation:T,getValidationStatus:P}),()=>{var e;return m("form",{class:te(),onSubmit:u},[(e=n.default)==null?void 0:e.call(n)])}}});const le=U(re),[ne,x]=R("cell-group"),ue={title:String,inset:Boolean,border:O};var ie=I({name:ne,inheritAttrs:!1,props:ue,setup(t,{slots:l,attrs:n}){const f=()=>{var c;return m("div",G({class:[x({inset:t.inset}),{[Y]:t.border&&!t.inset}]},n,L()),[(c=l.default)==null?void 0:c.call(l)])},p=()=>m("div",{class:x("title",{inset:t.inset})},[l.title?l.title():t.title]);return()=>t.title||l.title?m(z,null,[p(),f()]):f()}});const de=U(ie);function me(t,l){return q.post("/users/register",{userName:t,userPwd:l})}function ce(t,l){return q.post("/users/login",{userName:t,userPwd:l})}function fe(t,l,n){return q.post("/users/updatePassword",{userName:t,userPwd:l,newPwd:n})}const pe={class:"container"},ve={style:{margin:"16px"}},ge={__name:"Login",setup(t){const l=H(),n=V(!1),f=K(()=>n.value?"忘记密码":"用户注册"),p=V(""),c=V(""),g=V(!1),y=V(null),a=W({username:"",password:"",confirmPassword:"",oldPassword:"",newPassword:""}),h=()=>{n.value=!0,g.value=!0},T=()=>{n.value=!1,g.value=!0},P=u=>/^(?=.*[a-zA-Z])(?=.*\d).+$/.test(u),B=()=>a.password===a.confirmPassword,S=async u=>{if(u==="confirm")try{if(await y.value.validate(),n.value){const e=await fe(a.username,a.oldPassword,a.newPassword);return console.log(e),e.code===200?(v("密码修改成功"),p.value=e.data.name,c.value=e.data.pwd,Object.assign(a,{username:"",oldPassword:"",newPassword:""}),!0):(v(e.msg),!1)}else{if(a.password!==a.confirmPassword)return v("两次密码输入不一致"),!1;const e=await me(a.username,a.password);return e.code===200?(v("注册成功"),p.value=a.username,c.value=a.password,Object.assign(a,{username:"",password:"",confirmPassword:""}),!0):(v(e.msg),!1)}}catch(e){return console.error("验证失败",e),!1}return!0},k=async()=>{try{const u=await ce(p.value,c.value);console.log(u),u.code===200?(localStorage.setItem("token",u.data.token),localStorage.setItem("userInfo",JSON.stringify(u.data.userInfo)),v("登录成功"),l.push("/home")):v(u.msg)}catch(u){console.error("登录失败:",u),v("登录失败，请重试")}};return(u,e)=>{const s=Q,o=de,i=X,d=le,C=se;return _(),Z("div",pe,[e[9]||(e[9]=b("h2",null,"用户登录",-1)),m(d,{onSubmit:k},{default:w(()=>[m(o,{inset:""},{default:w(()=>[m(s,{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=r=>p.value=r),name:"username",label:"用户名",placeholder:"请输入用户名",rules:[{required:!0,message:"请填写用户名"}]},null,8,["modelValue"]),m(s,{modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=r=>c.value=r),type:"password",name:"password",label:"密码",placeholder:"请输入密码",rules:[{required:!0,message:"请填写密码"},{validator:P,message:"密码必须由英文+数字"}]},null,8,["modelValue","rules"])]),_:1}),b("div",ve,[m(i,{round:"",block:"",type:"primary","native-type":"submit"},{default:w(()=>e[8]||(e[8]=[ee(" 登录 ")])),_:1,__:[8]})])]),_:1}),b("div",{class:"action-links"},[b("a",{onClick:h},"忘记密码?"),b("a",{onClick:T},"注册新账号")]),m(C,{show:g.value,"onUpdate:show":e[7]||(e[7]=r=>g.value=r),title:f.value,"show-cancel-button":"","before-close":S},{default:w(()=>[m(d,{ref_key:"dialogFormRef",ref:y},{default:w(()=>[m(o,{inset:""},{default:w(()=>[m(s,{modelValue:a.username,"onUpdate:modelValue":e[2]||(e[2]=r=>a.username=r),label:"用户名",placeholder:"请输入用户名",rules:[{required:!0,message:"请填写用户名"}]},null,8,["modelValue"]),n.value?E("",!0):(_(),F(s,{key:0,modelValue:a.password,"onUpdate:modelValue":e[3]||(e[3]=r=>a.password=r),type:"password",label:"密码",placeholder:"请输入密码",rules:[{required:!0,message:"请填写密码"},{validator:P,message:"密码必须由英文+数字"}]},null,8,["modelValue","rules"])),n.value?E("",!0):(_(),F(s,{key:1,modelValue:a.confirmPassword,"onUpdate:modelValue":e[4]||(e[4]=r=>a.confirmPassword=r),type:"password",label:"确认密码",placeholder:"请再次输入密码",rules:[{required:!0,message:"请再次输入密码"},{validator:B,message:"两次密码输入不一致"}]},null,8,["modelValue","rules"])),n.value?(_(),F(s,{key:2,modelValue:a.oldPassword,"onUpdate:modelValue":e[5]||(e[5]=r=>a.oldPassword=r),type:"password",label:"旧密码",placeholder:"请输入旧密码",rules:[{required:!0,message:"请填写旧密码"}]},null,8,["modelValue"])):E("",!0),n.value?(_(),F(s,{key:3,modelValue:a.newPassword,"onUpdate:modelValue":e[6]||(e[6]=r=>a.newPassword=r),type:"password",label:"新密码",placeholder:"请输入新密码",rules:[{required:!0,message:"请填写新密码"},{validator:P,message:"密码必须由英文+数字"}]},null,8,["modelValue","rules"])):E("",!0)]),_:1})]),_:1},512)]),_:1},8,["show","title"])])}}},be=J(ge,[["__scopeId","data-v-82db4257"]]);export{be as default};
