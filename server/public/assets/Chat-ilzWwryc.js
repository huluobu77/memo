import{_ as g,r as p,l as v,M as S,N as h,s as c,v as r,a as _,O as b,Q as k,R as y,F as w,T as x,A as i,S as B,U as W}from"./index-D0UB2ddu.js";const C={class:"chat-page"},T={class:"chat-container"},V={class:"messages"},N={class:"input-container"},F={__name:"Chat",setup(I){const n=p([]),o=p("");let s=null;v(()=>{s=new WebSocket("ws://localhost:3001"),s.onmessage=async e=>{let t;e.data instanceof Blob?t=await e.data.text():t=e.data,n.value.push({text:t,isSent:!1}),d()},s.onopen=()=>{console.log("WebSocket 连接成功")},s.onerror=e=>{console.error("WebSocket 连接失败",e)}});const u=()=>{s&&s.readyState===WebSocket.OPEN&&s.close(1e3,"用户切换页面")};S((e,t,l)=>{u(),l()}),h(()=>{u()});function d(){setTimeout(()=>{const e=document.querySelector(".messages");e&&(e.scrollTop=e.scrollHeight)},50)}function m(){if(o.value.trim()&&s&&s.readyState===1){const e={text:o.value,isSent:!0,timestamp:new Date().toISOString()};s.send(o.value),n.value.push(e),o.value="",d()}else console.error("WebSocket未准备好或消息为空")}return(e,t)=>{const l=w;return i(),c("div",C,[r("div",T,[r("div",V,[(i(!0),c(b,null,k(n.value,(a,f)=>(i(),c("div",{key:f,class:B(["message",{sent:a.isSent}])},W(a.text),3))),128))]),r("div",N,[_(l,{modelValue:o.value,"onUpdate:modelValue":t[0]||(t[0]=a=>o.value=a),placeholder:"请输入消息...",onKeyup:y(m,["enter"]),"right-icon":"arrow-up",onClickRightIcon:m,class:"message-input",clearable:"",border:""},null,8,["modelValue"])])]),_(x)])}}},R=g(F,[["__scopeId","data-v-7b4f6da3"]]);export{R as default};
