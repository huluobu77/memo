import{_ as B,V as D,r as A,s as f,v as c,a,x as l,F as T,D as F,I as L,B as z,T as Y,O as E,z as R,A as g,C as v,L as S,E as r,W as H,G as M}from"./index-D0UB2ddu.js";import{d as O,N as j,U as G,I as J}from"./dayjs.min-UscHACuv.js";import"./use-placeholder-Bc7RdSAY.js";const P={class:"add-note-container"},W={class:"upload-section"},q={key:0,class:"image-preview"},K={class:"action-buttons"},Q="http://localhost:3000",X={__name:"AddNote",setup(Z){const d=R(),U=O().format("YYYY-MM-DD HH:mm:ss"),e=D({id:"",title:"",content:"",imgUrl:""}),s=A([]),b=async o=>{const t=new FormData;t.append("file",o);const i=await M.post("/api/notes/uploadImg",t,{headers:{"Content-Type":"multipart/form-data"}});i.data.code===200?(e.imgUrl=Q+i.data.imgUrl,s.value=[{url:e.imgUrl}]):r("图片上传失败")},V=o=>{const t=Array.isArray(o)?o[0]:o;b(t.file)},x=async()=>{if(!e.title.trim()){r("请输入标题");return}if(!e.content.trim()){r("请输入内容");return}const o=JSON.parse(localStorage.getItem("userInfo")),t=await H(o.id,e.title,e.content,U,e.imgUrl);console.log("添加：",t),t.code===200?(r("添加成功"),N(),d.back()):r("添加失败")},y=()=>new Promise(o=>{Dialog.confirm({title:"提示",message:"确定要删除这张图片吗？"}).then(()=>{p(),o(!0)}).catch(()=>{o(!1)})}),p=()=>{e.imgUrl="",s.value=[]},w=()=>e.title.trim()||e.content.trim()||e.imgUrl,I=()=>{w()?Dialog.confirm({title:"未保存的更改",message:"您有未保存的更改，确定要离开吗？"}).then(()=>{d.back()}).catch(()=>{}):d.back()},N=()=>{e.title="",e.content="",e.imgUrl="",s.value=[]};return(o,t)=>{const i=j,m=L,u=T,_=z,k=G,h=S,C=J;return g(),f(E,null,[c("div",P,[a(i,{title:"添加笔记","left-text":"返回","left-arrow":"",onClickLeft:I,fixed:"",placeholder:""}),a(u,{modelValue:e.title,"onUpdate:modelValue":t[0]||(t[0]=n=>e.title=n),placeholder:"请输入笔记标题",class:"title-input",clearable:"",border:!1},{"left-icon":l(()=>[a(m,{name:"edit",color:"#1989fa"})]),_:1},8,["modelValue"]),a(u,{modelValue:e.content,"onUpdate:modelValue":t[1]||(t[1]=n=>e.content=n),type:"textarea",placeholder:"请输入笔记内容...",rows:"10",class:"content-input",border:!1},null,8,["modelValue"]),c("div",W,[t[4]||(t[4]=c("div",{class:"upload-title"},"添加图片（限1张）",-1)),a(k,{modelValue:s.value,"onUpdate:modelValue":t[2]||(t[2]=n=>s.value=n),"after-read":V,"before-delete":y,"max-count":1,accept:"image/*","preview-image":!1,class:"image-uploader"},{default:l(()=>[a(_,{icon:"plus",type:"primary",round:""},{default:l(()=>t[3]||(t[3]=[v("选择图片")])),_:1,__:[3]})]),_:1},8,["modelValue"]),e.imgUrl?(g(),f("div",q,[a(C,{width:"100%",height:"200px",src:e.imgUrl,fit:"cover",radius:"8px"},{loading:l(()=>[a(h,{type:"spinner",size:"20"})]),_:1},8,["src"]),a(m,{name:"clear",class:"delete-image",onClick:p})])):F("",!0)]),c("div",K,[a(_,{round:"",type:"primary",size:"large",class:"add-btn",onClick:x,disabled:!e.title.trim()},{default:l(()=>[a(m,{name:"plus",size:"20"}),t[5]||(t[5]=v(" 添加笔记 "))]),_:1,__:[5]},8,["disabled"])])]),a(Y)],64)}}},ae=B(X,[["__scopeId","data-v-c864076d"]]);export{ae as default};
