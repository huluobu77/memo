import{d as j,e as S,c as J,a as t,m as F,p as $,P as q,b as G,t as x,f as Q,g as X,h as Z,I as T,H as ee,n as te,L as K,w as ae,i as ne,j as oe,u as se,_ as le,r as N,k as ie,o as re,l as ce,q as ue,s as L,v as _,x as r,F as de,y as H,B as me,T as pe,z as fe,A as P,C as y,D as ve,E as f,G as ge,J as _e,K as ye}from"./index-D0UB2ddu.js";import{d as be,N as ke,I as Ce,U as he}from"./dayjs.min-UscHACuv.js";import{s as we}from"./index-BJ8oVMt3.js";import"./use-placeholder-Bc7RdSAY.js";const[Be,c]=J("action-sheet"),Ie=S({},G,{title:String,round:x,actions:X(),closeIcon:Q("cross"),closeable:x,cancelText:String,description:String,closeOnPopstate:x,closeOnClickAction:Boolean,safeAreaInsetBottom:x}),xe=[...Z,"round","closeOnPopstate","safeAreaInsetBottom"];var Ne=j({name:Be,props:Ie,emits:["select","cancel","update:show"],setup(s,{slots:l,emit:p}){const u=a=>p("update:show",a),b=()=>{u(!1),p("cancel")},h=()=>{if(s.title)return t("div",{class:c("header")},[s.title,s.closeable&&t(T,{name:s.closeIcon,class:[c("close"),ee],onClick:b},null)])},v=()=>{if(l.cancel||s.cancelText)return[t("div",{class:c("gap")},null),t("button",{type:"button",class:c("cancel"),onClick:b},[l.cancel?l.cancel():s.cancelText])]},i=a=>{if(a.icon)return t(T,{class:c("item-icon"),name:a.icon},null)},n=(a,k)=>a.loading?t(K,{class:c("loading-icon")},null):l.action?l.action({action:a,index:k}):[t("span",{class:c("name")},[a.name]),a.subname&&t("div",{class:c("subname")},[a.subname])],w=(a,k)=>{const{color:U,loading:I,callback:o,disabled:e,className:C}=a,d=()=>{e||I||(o&&o(a),s.closeOnClickAction&&u(!1),te(()=>p("select",a,k)))};return t("button",{type:"button",style:{color:U},class:[c("item",{loading:I,disabled:e}),C],onClick:d},[i(a),n(a,k)])},B=()=>{if(s.description||l.description){const a=l.description?l.description():s.description;return t("div",{class:c("description")},[a])}};return()=>t(q,F({class:c(),position:"bottom","onUpdate:show":u},$(s,xe)),{default:()=>{var a;return[h(),B(),t("div",{class:c("content")},[s.actions.map(w),(a=l.default)==null?void 0:a.call(l)]),v()]}})}});const Pe=ae(Ne);let V;const Se={title:"",width:"",theme:null,message:"",overlay:!0,callback:null,teleport:"body",className:"",allowHtml:!1,lockScroll:!0,transition:void 0,beforeClose:null,overlayClass:"",overlayStyle:void 0,messageAlign:"",cancelButtonText:"",cancelButtonColor:null,cancelButtonDisabled:!1,confirmButtonText:"",confirmButtonColor:null,confirmButtonDisabled:!1,showConfirmButton:!0,showCancelButton:!1,closeOnPopstate:!0,closeOnClickOverlay:!1,destroyOnClose:!1};let Ue=S({},Se);function Ae(){({instance:V}=oe({setup(){const{state:l,toggle:p}=se();return()=>t(we,F(l,{"onUpdate:show":p}),null)}}))}function Te(s){return ne?new Promise((l,p)=>{V||Ae(),V.open(S({},Ue,s,{callback:u=>{(u==="confirm"?l:p)(u)}}))}):Promise.resolve(void 0)}const A=s=>Te(S({showCancelButton:!0},s)),Ve={class:"edit-note-page"},De={class:"edit-note-container"},Oe={class:"image-edit-section"},ze={class:"image-container"},Ee={key:0,class:"image-preview"},Le={class:"image-actions"},He={class:"image-picker-content"},Re={class:"action-buttons"},R="http://localhost:3000",Fe={__name:"EditNote",setup(s){const l=be().format("YYYY-MM-DD HH:mm:ss"),p=ie(),u=fe(),b=JSON.parse(localStorage.getItem("userInfo")),h=N(p.params.id),v=N(!1),i=N([]);re(()=>{var o;(o=i.value[0])!=null&&o.url&&URL.revokeObjectURL(i.value[0].url)}),ce(async()=>{const o=await ue(h.value,b.id);if(o.code===200&&(n.value=o.data,o.data.img)){const e=o.data.img.startsWith("http")?o.data.img:R+o.data.img;n.value.img=e,i.value=[{url:e,name:"note-image.png",status:"done",isImage:!0}]}});const n=N({id:null,title:"",content:"",updateTime:"",img:""}),w=async o=>{const e=Array.isArray(o)?o[0]:o;if(!e.file.type.startsWith("image/")){f("请上传图片文件"),i.value=[];return}if(e.file.size>2*1024*1024){f("图片大小不能超过2MB"),i.value=[];return}const C=new FormData;C.append("file",e.file);try{const d=await ge.post("/api/notes/uploadImg",C,{headers:{"Content-Type":"multipart/form-data"}});d.data.code===200?(n.value.img=R+d.data.imgUrl,i.value=[{url:n.value.img,name:e.file.name||"note-image.png",status:"done",isImage:!0}],v.value=!1,f("图片已更新")):f("图片上传失败")}catch{f("图片上传失败")}},B=()=>{n.value.img="",i.value=[],v.value=!1,f("图片已删除")},a=()=>{k()?A({title:"未保存的更改",message:"您有未保存的更改，确定要离开吗？"}).then(()=>{u.back()}).catch(()=>{}):u.back()},k=()=>n.value.title.trim()||n.value.content.trim()||n.value.img!==initialNoteState.img,U=()=>{A({title:"保存确认",message:"确定要保存对笔记的修改吗？"}).then(async()=>{console.log(n.value.img),(await ye(h.value,b.id,n.value.title,n.value.content,l,n.value.img)).code===200&&(f("保存成功"),u.back())}).catch(o=>{console.log("保存取消或出错",o)})},I=()=>{A({title:"删除确认",message:"确定要删除这篇笔记吗？此操作不可恢复。",confirmButtonColor:"#ee0a24"}).then(async()=>{(await _e(h.value,b.id)).code===200?(f("删除成功"),u.back()):f("删除失败")}).catch(()=>{})};return(o,e)=>{var z,E;const C=ke,d=T,D=de,M=K,W=Ce,g=me,O=he,Y=Pe;return P(),L("div",Ve,[t(C,{title:"编辑",class:"edit-nav-bar","left-text":"返回","left-arrow":"",onClickLeft:a,fixed:"",placeholder:""}),_("div",De,[t(D,{modelValue:n.value.title,"onUpdate:modelValue":e[0]||(e[0]=m=>n.value.title=m),placeholder:"请输入笔记标题",class:"title-input",clearable:"",border:!1},{"left-icon":r(()=>[t(d,{name:"edit",color:"#1989fa"})]),_:1},8,["modelValue"]),t(D,{modelValue:n.value.content,"onUpdate:modelValue":e[1]||(e[1]=m=>n.value.content=m),type:"textarea",placeholder:"请输入笔记内容...",rows:"15",class:"content-input",border:!1},null,8,["modelValue"]),_("div",Oe,[e[9]||(e[9]=_("div",{class:"section-title"},"笔记图片",-1)),_("div",ze,[i.value.length>0?(P(),L("div",Ee,[t(W,{width:"100%",height:"150px",src:((z=i.value[0])==null?void 0:z.url)||n.value.img,fit:"cover",radius:"8px"},{loading:r(()=>[t(M,{type:"spinner",size:"20"})]),_:1},8,["src"]),_("div",Le,[t(g,{round:"",size:"small",type:"primary",onClick:e[2]||(e[2]=m=>v.value=!0)},{default:r(()=>[t(d,{name:"edit"}),e[6]||(e[6]=y(" 更换 "))]),_:1,__:[6]}),t(g,{round:"",size:"small",type:"danger",onClick:B},{default:r(()=>[t(d,{name:"delete"}),e[7]||(e[7]=y(" 删除 "))]),_:1,__:[7]})])])):(P(),H(O,{key:1,modelValue:i.value,"onUpdate:modelValue":e[3]||(e[3]=m=>i.value=m),"after-read":w,"max-count":1,accept:"image/*","preview-image":!0},{default:r(()=>[t(g,{icon:"plus",type:"primary",round:""},{default:r(()=>e[8]||(e[8]=[y("添加图片")])),_:1,__:[8]})]),_:1},8,["modelValue"]))])]),t(Y,{show:v.value,"onUpdate:show":e[5]||(e[5]=m=>v.value=m),title:"修改图片"},{default:r(()=>[_("div",He,[t(O,{modelValue:i.value,"onUpdate:modelValue":e[4]||(e[4]=m=>i.value=m),"after-read":w,"max-count":1,accept:"image/*"},{default:r(()=>[t(g,{icon:"plus",type:"primary",block:""},{default:r(()=>e[10]||(e[10]=[y("选择新图片")])),_:1,__:[10]})]),_:1},8,["modelValue"]),n.value.img?(P(),H(g,{key:0,type:"danger",block:"",onClick:B,style:{"margin-top":"10px"}},{default:r(()=>e[11]||(e[11]=[y(" 删除当前图片 ")])),_:1,__:[11]})):ve("",!0)])]),_:1},8,["show"]),_("div",Re,[t(g,{round:"",type:"danger",size:"large",class:"delete-btn",onClick:I},{default:r(()=>[t(d,{name:"delete",size:"20"}),e[12]||(e[12]=y(" 删除笔记 "))]),_:1,__:[12]}),t(g,{round:"",type:"primary",size:"large",class:"save-btn",onClick:U,disabled:!((E=n.value.title)!=null&&E.trim())},{default:r(()=>[t(d,{name:"success",size:"20"}),e[13]||(e[13]=y(" 保存修改 "))]),_:1,__:[13]},8,["disabled"])])]),t(pe)])}}},je=le(Fe,[["__scopeId","data-v-fdc365ee"]]);export{je as default};
